<!-- templates/admin/dashboard.html -->
{% extends 'admin/layout.html' %}

{% block title %}Admin Dashboard - World Hotels{% endblock %}

{% block page_title %}Dashboard Overview{% endblock %}

{% block extra_css %}
<style>
    /* Stats Cards */
    .stats-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        height: 100%;
        transition: all 0.3s ease;
        border: 1px solid var(--border-color);
    }

    .stats-card:hover {
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .stats-card h3 {
        color: var(--text-secondary);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 1rem;
    }

    .stats-card .number {
        font-size: 2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .stats-card .trend {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .stats-card .trend i {
        color: var(--success-color);
        margin-right: 0.5rem;
    }

    /* Chart Cards */
    .card-title {
        font-size: 1.1rem;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
    }

    /* Recent Bookings Table */
    .table-hover tbody tr:hover {
        background-color: rgba(52, 152, 219, 0.05);
    }

    .badge {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 500;
    }

    .badge.bg-pending {
        background-color: #fff3cd !important;
        color: #856404 !important;
    }

    .badge.bg-confirmed {
        background-color: #d4edda !important;
        color: #155724 !important;
    }

    .badge.bg-cancelled {
        background-color: #f8d7da !important;
        color: #721c24 !important;
    }

    /* Mobile Responsive Styles */
    @media (max-width: 768px) {
        .row.g-3 {
            margin: 0 -0.5rem;
        }

        .col-md-3 {
            padding: 0 0.5rem;
        }

        .stats-card {
            margin-bottom: 1rem;
            padding: 1.25rem;
        }

        .stats-card h3 {
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        .stats-card .number {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .stats-card .trend {
            font-size: 0.75rem;
        }

        /* Charts Responsiveness */
        .card {
            margin-bottom: 1rem;
        }

        .card-body {
            padding: 1rem;
        }

        .card-title {
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        /* Table Responsiveness */
        .table-responsive {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 0 -1rem;
            width: calc(100% + 2rem);
        }

        .table th, 
        .table td {
            white-space: nowrap;
            padding: 0.75rem 0.5rem;
        }

        .badge {
            white-space: nowrap;
        }
    }

    /* Extra Small Devices */
    @media (max-width: 576px) {
        .stats-card {
            padding: 1rem;
        }

        .stats-card .number {
            font-size: 1.25rem;
        }

        .table th, 
        .table td {
            font-size: 0.85rem;
            padding: 0.5rem;
        }
    }
</style>
{% endblock %}


{% block content %}
<!-- Statistics Cards -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="stats-card">
            <h3>Total Bookings</h3>
            <div class="number">{{ stats.total_bookings }}</div>
            <div class="trend">
                <i class="bi bi-graph-up"></i> Last 30 days
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <h3>Total Revenue</h3>
            <div class="number">£{{ "%.2f"|format(stats.total_revenue or 0) }}</div>
            <div class="trend">
                <i class="bi bi-graph-up"></i> Last 30 days
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <h3>Active Hotels</h3>
            <div class="number">{{ stats.total_hotels }}</div>
            <div class="trend">
                <i class="bi bi-building"></i> Total properties
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <h3>Registered Users</h3>
            <div class="number">{{ stats.total_users }}</div>
            <div class="trend">
                <i class="bi bi-people"></i> Customer accounts
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Revenue by Hotel</h5>
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Occupancy Rates</h5>
                <canvas id="occupancyChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Recent Bookings -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Recent Bookings</h5>
        <a href="{{ url_for('manage_bookings') }}" class="btn btn-sm btn-dark">
            View All
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Reference</th>
                        <th>Guest</th>
                        <th>Hotel</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>Amount</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in recent_bookings %}
                    <tr>
                        <td>{{ booking.booking_reference }}</td>
                        <td>{{ booking.guest_name }}</td>
                        <td>{{ booking.hotel_name }}</td>
                        <td>{{ booking.check_in_date|date }}</td>
                        <td>{{ booking.check_out_date|date }}</td>
                        <td>£{{ "%.2f"|format(booking.final_amount) }}</td>
                        <td>
                            <span class="badge bg-{{ booking.status }} text-dark">
                                {{ booking.status|title }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Get data from backend
    const hotelData = {
        revenue: {
            labels: JSON.parse('{{ hotel_revenue|map(attribute="hotel_name")|list|tojson|safe }}'),
            values: JSON.parse('{{ hotel_revenue|map(attribute="revenue")|list|tojson|safe }}')
        },
        occupancy: {
            labels: JSON.parse('{{ occupancy_rates|map(attribute="hotel_name")|list|tojson|safe }}'),
            rates: JSON.parse('{{ occupancy_rates|map(attribute="occupancy_rate")|list|tojson|safe }}')
        }
    };
    
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'bar',
        data: {
            labels: hotelData.revenue.labels,
            datasets: [{
                label: 'Revenue (£)',
                data: hotelData.revenue.values,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
        
    // Occupancy Chart
    const occupancyCtx = document.getElementById('occupancyChart').getContext('2d');
    new Chart(occupancyCtx, {
        type: 'doughnut',
        data: {
            labels: hotelData.occupancy.labels,
            datasets: [{
                data: hotelData.occupancy.rates,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
    </script>
{% endblock %}